sudo: false

language: c

addons:
  apt:
    sources:
      - sourceline: 'deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-3.8 main'
        key_url: 'http://apt.llvm.org/llvm-snapshot.gpg.key'
    packages:
      - libgmp-dev

cache:
  apt: true
  directories:
    - $HOME/.stack/

before_install:
  # Install stack
  - mkdir -p $HOME/.local/bin $HOME/.local/include $HOME/.local/lib
  - export PATH=~/.local/bin:$PATH
  - export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/.local/lib
  - travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'

install:
  - (cd haskell && stack update)
  - (cd haskell && stack setup)
  - (cd haskell && stack build --only-dependencies)

script:
  - (cd haskell && stack build --test)
